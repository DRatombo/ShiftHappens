<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Budget Buddy</title>
    <link href="./styles.css" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
</head>
<body class="bg-gradient-to-br from-primary-50 to-secondary-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-3">
                    <a href="/" class="flex items-center space-x-3">
                        <div class="text-3xl">ðŸ’°</div>
                        <h1 class="text-2xl font-bold text-gradient">Budget Buddy</h1>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-gray-600 hover:text-primary-600">Back to Home</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-md mx-auto px-4 py-16">
        <div class="card">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Create Your Account</h2>
                <p class="text-gray-600">Join Budget Buddy and start your financial journey today</p>
            </div>

            <!-- Sign Up Form -->
            <form id="signupForm" class="space-y-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                    <input type="text" id="name" name="name" class="input-field" placeholder="Enter your full name" required>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="email" name="email" class="input-field" placeholder="Enter your email" required>
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="password" name="password" class="input-field" placeholder="Create a password" required minlength="6">
                    <p class="text-sm text-gray-500 mt-1">Password must be at least 6 characters long</p>
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" class="input-field" placeholder="Confirm your password" required>
                </div>

                <div class="flex items-start space-x-3">
                    <input type="checkbox" id="terms" name="terms" class="mt-1" required>
                    <label for="terms" class="text-sm text-gray-600">
                        I agree to the <a href="#" class="text-primary-600 hover:underline">Terms of Service</a> 
                        and <a href="#" class="text-primary-600 hover:underline">Privacy Policy</a>
                    </label>
                </div>

                <button type="submit" class="btn-primary w-full text-lg py-4">
                    Create Account ðŸš€
                </button>
            </form>

            <!-- Login Link -->
            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    Already have an account? 
                    <a href="#" id="loginLink" class="text-primary-600 hover:underline font-medium">Sign in here</a>
                </p>
            </div>
        </div>

        <!-- Login Form (Hidden by default) -->
        <div id="loginForm" class="card hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome Back</h2>
                <p class="text-gray-600">Sign in to your Budget Buddy account</p>
            </div>

            <form id="loginFormElement" class="space-y-6">
                <div>
                    <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="loginEmail" name="email" class="input-field" placeholder="Enter your email" required>
                </div>

                <div>
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="loginPassword" name="password" class="input-field" placeholder="Enter your password" required>
                </div>

                <button type="submit" class="btn-primary w-full text-lg py-4">
                    Sign In ðŸ”‘
                </button>
            </form>

            <!-- Sign Up Link -->
            <div class="mt-6 text-center">
                <p class="text-gray-600">
                    Don't have an account? 
                    <a href="#" id="signupLink" class="text-primary-600 hover:underline font-medium">Create one here</a>
                </p>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center animate-float">
            <div class="text-6xl mb-4">ðŸŽ‰</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Welcome to Budget Buddy!</h3>
            <p class="text-gray-600 mb-4">Your account has been created successfully. Let's set up your budget!</p>
            <button id="continueBtn" class="btn-primary">Continue to Setup</button>
        </div>
    </div>

    <script>
        class AuthManager {
            constructor() {
                this.isLoginMode = false;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkAuthStatus();
            }

            setupEventListeners() {
                // Form submissions
                document.getElementById('signupForm').addEventListener('submit', (e) => this.handleSignup(e));
                document.getElementById('loginFormElement').addEventListener('submit', (e) => this.handleLogin(e));
                
                // Toggle between signup and login
                document.getElementById('loginLink').addEventListener('click', (e) => this.toggleMode(e));
                document.getElementById('signupLink').addEventListener('click', (e) => this.toggleMode(e));
                
                // Modal
                document.getElementById('continueBtn').addEventListener('click', () => this.continueToSetup());
                
                // Password confirmation validation
                document.getElementById('confirmPassword').addEventListener('input', () => this.validatePasswordMatch());
            }

            toggleMode(e) {
                e.preventDefault();
                this.isLoginMode = !this.isLoginMode;
                
                const signupForm = document.getElementById('signupForm').parentElement;
                const loginForm = document.getElementById('loginForm');
                
                if (this.isLoginMode) {
                    signupForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                } else {
                    signupForm.classList.remove('hidden');
                    loginForm.classList.add('hidden');
                }
            }

            validatePasswordMatch() {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const confirmField = document.getElementById('confirmPassword');
                
                if (confirmPassword && password !== confirmPassword) {
                    confirmField.style.borderColor = '#ef4444';
                    confirmField.style.backgroundColor = '#fef2f2';
                } else {
                    confirmField.style.borderColor = '';
                    confirmField.style.backgroundColor = '';
                }
            }

            async handleSignup(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const password = formData.get('password');
                const confirmPassword = formData.get('confirmPassword');
                
                if (password !== confirmPassword) {
                    this.showError('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('Password must be at least 6 characters long');
                    return;
                }
                
                const userData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    password: password
                };
                
                try {
                    const response = await fetch('/api/auth/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showSuccessModal();
                    } else {
                        this.showError(result.error || 'Failed to create account');
                    }
                } catch (error) {
                    console.error('Error signing up:', error);
                    this.showError('Network error. Please try again.');
                }
            }

            async handleLogin(e) {
                e.preventDefault();
                
                const formData = new FormData(e.target);
                const loginData = {
                    email: formData.get('email'),
                    password: formData.get('password')
                };
                
                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(loginData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        window.location.href = '/dashboard';
                    } else {
                        this.showError(result.error || 'Invalid credentials');
                    }
                } catch (error) {
                    console.error('Error logging in:', error);
                    this.showError('Network error. Please try again.');
                }
            }

            showSuccessModal() {
                document.getElementById('successModal').classList.remove('hidden');
                document.getElementById('successModal').classList.add('flex');
            }

            continueToSetup() {
                window.location.href = '/income';
            }

            checkAuthStatus() {
                fetch('/api/auth/me')
                    .then(response => response.json())
                    .then(data => {
                        if (data.user) {
                            window.location.href = '/dashboard';
                        }
                    })
                    .catch(() => {
                        // User is not authenticated, stay on signup page
                    });
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);
                
                setTimeout(() => {
                    document.body.removeChild(errorDiv);
                }, 5000);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new AuthManager();
        });
    </script>
</body>
</html>
